From 4f2dd9768c4195249cc3e904f345bc35e72b71ec Mon Sep 17 00:00:00 2001
From: Zugfritze <70323844+Zugfritze@users.noreply.github.com>
Date: Fri, 1 Sep 2023 20:38:50 +0800
Subject: [PATCH] =?UTF-8?q?=E4=B8=B4=E6=97=B6=E6=81=A2=E5=A4=8D#67837?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/mapgen.cpp     | 6 +++++-
 src/mapgendata.cpp | 5 +++++
 src/mapgendata.h   | 1 +
 3 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/src/mapgen.cpp b/src/mapgen.cpp
index 4bdf200f00..76727526fd 100644
--- a/src/mapgen.cpp
+++ b/src/mapgen.cpp
@@ -5128,7 +5128,11 @@ void mapgen_function_json::generate( mapgendata &md )
     } else if( expects_predecessor() ) {
         if( md.has_predecessor() ) {
             mapgendata predecessor_md( md, md.last_predecessor() );
-            predecessor_md.pop_last_predecessor();
+            if( ter.has_flag( oter_flags::line_drawing ) ) {
+                predecessor_md.clear_predecessors();
+            } else {
+                predecessor_md.pop_last_predecessor();
+            }
             do_predecessor_mapgen( predecessor_md );
         } else {
             mapgendata predecessor_md( md, fallback_predecessor_mapgen_ );
diff --git a/src/mapgendata.cpp b/src/mapgendata.cpp
index f203b99379..b01953860b 100644
--- a/src/mapgendata.cpp
+++ b/src/mapgendata.cpp
@@ -298,6 +298,11 @@ const oter_id &mapgendata::last_predecessor() const
     return predecessors_.back();
 }
 
+void mapgendata::clear_predecessors()
+{
+    predecessors_.clear();
+}
+
 void mapgendata::pop_last_predecessor()
 {
     if( predecessors_.empty() ) {
diff --git a/src/mapgendata.h b/src/mapgendata.h
index 2f7016add7..20dc64ee6c 100644
--- a/src/mapgendata.h
+++ b/src/mapgendata.h
@@ -235,6 +235,7 @@ class mapgendata
 
         bool has_predecessor() const;
         const oter_id &last_predecessor() const;
+        void clear_predecessors();
         void pop_last_predecessor();
 
         template<typename Result>
-- 
2.42.0.windows.1

